{"version":3,"file":"defer.js","sourceRoot":"","sources":["defer.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,sCAC0F;AAC1F,0CAA6C;AAC7C,gDAA6C;AAQ7C,IAAa,cAAc;IAUvB,wBAAmB,EAAc,EAAS,UAAsB,EAAS,QAAmB,EAAS,aAA+B;QAAjH,OAAE,GAAF,EAAE,CAAY;QAAS,eAAU,GAAV,UAAU,CAAY;QAAS,aAAQ,GAAR,QAAQ,CAAW;QAAS,kBAAa,GAAb,aAAa,CAAkB;QAR1H,WAAM,GAAsB,IAAI,mBAAY,EAAE,CAAC;IAQ8E,CAAC;IAExI,wCAAe,GAAf;QAAA,iBAYC;QAXG,EAAE,CAAA,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;YACnB,IAAI,CAAC,IAAI,EAAE,CAAC;QAChB,CAAC;QAED,IAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,EAAE,QAAQ,EAAE;YACnE,EAAE,CAAA,CAAC,KAAI,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;gBACnB,KAAI,CAAC,IAAI,EAAE,CAAC;gBACZ,KAAI,CAAC,sBAAsB,EAAE,CAAC;gBAC9B,KAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC;YACvC,CAAC;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAED,mCAAU,GAAV;QACI,IAAI,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,qBAAqB,EAAE,CAAC;QACzD,IAAI,UAAU,GAAG,QAAQ,CAAC,eAAe,CAAC;QAC1C,IAAI,SAAS,GAAG,CAAC,MAAM,CAAC,WAAW,IAAE,QAAQ,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC;QACzE,IAAI,SAAS,GAAG,UAAU,CAAC,YAAY,CAAC;QAExC,MAAM,CAAC,CAAC,SAAS,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC;IACnC,CAAC;IAED,6BAAI,GAAJ;QACI,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACjE,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;IACvB,CAAC;IAED,oCAAW,GAAX;QACI,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QAEjB,EAAE,CAAA,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC,CAAC;YAC7B,IAAI,CAAC,sBAAsB,EAAE,CAAC;QAClC,CAAC;IACL,CAAC;IACL,qBAAC;AAAD,CAAC,AA/CD,IA+CC;AA7Ca;IAAT,aAAM,EAAE;8BAAS,mBAAY;8CAA2B;AAE9B;IAA1B,mBAAY,CAAC,kBAAW,CAAC;8BAAW,kBAAW;gDAAM;AAJ7C,cAAc;IAN1B,gBAAS,CAAC;QACP,QAAQ,EAAE,UAAU;QACpB,IAAI,EAAE,EACL;QACD,SAAS,EAAE,CAAC,uBAAU,CAAC;KAC1B,CAAC;qCAWyB,iBAAU,EAAqB,uBAAU,EAAmB,gBAAS,EAAwB,uBAAgB;GAV3H,cAAc,CA+C1B;AA/CY,wCAAc;AAsD3B,IAAa,WAAW;IAAxB;IAA2B,CAAC;IAAD,kBAAC;AAAD,CAAC,AAA5B,IAA4B;AAAf,WAAW;IALvB,eAAQ,CAAC;QACN,OAAO,EAAE,CAAC,qBAAY,CAAC;QACvB,OAAO,EAAE,CAAC,cAAc,CAAC;QACzB,YAAY,EAAE,CAAC,cAAc,CAAC;KACjC,CAAC;GACW,WAAW,CAAI;AAAf,kCAAW","sourcesContent":["import {NgModule,Directive,ElementRef,AfterViewInit,OnDestroy,Input,TemplateRef,EmbeddedViewRef,\n        ViewContainerRef,Renderer2,EventEmitter,Output,ContentChild} from '@angular/core';\nimport {CommonModule} from '@angular/common';\nimport {DomHandler} from '../dom/domhandler';\n\n@Directive({\n    selector: '[pDefer]',\n    host: {\n    },\n    providers: [DomHandler]\n})\nexport class DeferredLoader implements AfterViewInit,OnDestroy {\n        \n    @Output() onLoad: EventEmitter<any> = new EventEmitter();\n    \n    @ContentChild(TemplateRef) template: TemplateRef<any>;\n        \n    documentScrollListener: Function;\n    \n    view: EmbeddedViewRef<any>;\n            \n    constructor(public el: ElementRef, public domHandler: DomHandler, public renderer: Renderer2, public viewContainer: ViewContainerRef) {}\n    \n    ngAfterViewInit() {\n        if(this.shouldLoad()) {\n            this.load();\n        }\n        \n        this.documentScrollListener = this.renderer.listen('window', 'scroll', () => {\n            if(this.shouldLoad()) {\n                this.load();\n                this.documentScrollListener();\n                this.documentScrollListener = null;\n            }\n        });\n    }\n    \n    shouldLoad(): boolean {\n        let rect = this.el.nativeElement.getBoundingClientRect();\n        let docElement = document.documentElement;\n        let scrollTop = (window.pageYOffset||document.documentElement.scrollTop);\n        let winHeight = docElement.clientHeight;\n        \n        return (winHeight >= rect.top);\n    }\n    \n    load(): void {     \n        this.view = this.viewContainer.createEmbeddedView(this.template);\n        this.onLoad.emit();\n    }\n            \n    ngOnDestroy() {\n        this.view = null;\n        \n        if(this.documentScrollListener) {\n            this.documentScrollListener();\n        }\n    }\n}\n\n@NgModule({\n    imports: [CommonModule],\n    exports: [DeferredLoader],\n    declarations: [DeferredLoader]\n})\nexport class DeferModule { }"]}